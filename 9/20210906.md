# 2021년 9월 6일 [78일차]

## # 오전수업
----
### `09:30~`

<복습>   

비동기방식 검색.  

JSP 표현.    

오라클 쿼리.   

#

세션처리 하는법. 진도.   

현 상태는 로그인 하는법 말고도,  

직접 주소를 입력하고 들어가면 로그인이 의미가 없어진다.  

![세션처리 설명](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210906%200944_%EC%84%B8%EC%85%98%EC%B2%98%EB%A6%AC_1_.png)     

>     
> `@ModelAttribute` 어노테이션이 붙은 메소드는,   
> `@RequestMapping` 붙은 메소드가 호출되기전에 먼저 호출되는 메소드이다.   
> 이 메소드에서 로그인정보를 확인하고 처리하면 된다.  
> 하지만, `@Controller` 가 붙은 객체가 하나가 아니기에, Spring 은 `@Controller` 객체로 들어가기 전에,  
> `Dispacherservlet` 객체 안에서 과정을 진행하는 방법이 있다. (ex : 학교정문에서 검사) 한곳에서 처리.    

#

로그인 하면서 거치는 순서.  

`loginForm.jsp` 에서,  
비동기방식으로 아이디 암호를 `"/loginProc.do"` 로 넘긴다.  

`LoginController.java` 로 가서, 
`@RequestMapping( value="/loginProc.do")` 로,  
아이디 암호를 받고, HashMap 객체에,  
아이디 암호를 저장하고 진행된다.    
> 쿼리문에 2개이상의 데이터가 참여하려면 HashMap 에 저장해야 한다.  

#

`LoginController.java` 에서,  
`"/loginProc.do"` 부분 코딩 시작.  
`Spring+JSP_교재_ver_01.txt` 에서   
<문7> 보기. (입) 입사시험. 각 객체의 역할 알아두기.            
> `HttpSession 객체`에 대해서 다시 공부하기.     
> `[고유아이디]` 를 쿠키로 저장하여 로그인여부 확인.  
> 로그인 성공정보를 저장하여 로그인 유지.   
> 재 접속할때마다 꺼내볼 정보를 저장하는곳.  
> 개인 저장고 역할.  


```java
  // --------------------------------------------------
  // 만약 login_idCnt q변수 안의 데이터가 1이면
  // 즉, 만약 입력한 아이디 암호가 DB에 존재하면
  // 즉, 만약 로그인이 성공했으면
  // --------------------------------------------------
  if( login_idCnt==1 ){

  }
```

#

----
### `10:30~`  

전 시간 이어서,  


```java

// "/loginProc.do" 상단쪽.  

  // ---------------------------------------
  // "pwd" 라는 파라미터명에 해당하는 파라미터값을 꺼내서 매개변수 pwd 에 저장하고 들어온다.
  // ---------------------------------------
  ,@RequestParam( value="pwd" ) String pwd

// ==============================
// 위쪽은 위치확인용코드, 
// 아래 코드를 추가한것이다.



  // ---------------------------------------
  // HttpSession 객체의 메위주를 저장하는 매개변수 session 선언하기
  // ---------------------------------------
  ,HttpSession session



// ==============================



  // --------------------------------------------------
  // 만약 login_idCnt q변수 안의 데이터가 1이면
  // 즉, 만약 입력한 아이디 암호가 DB에 존재하면
  // 즉, 만약 로그인이 성공했으면
  // --------------------------------------------------
  if( login_idCnt==1 ){
      
      // HttpSession 객체에 로그인 아이디 저장하기  
      // HttpSession 객체에 로그인 아이디를 저장하면 재 접속 했을 때 다시 꺼내 볼 수 있다.  
      // <참고> HttpSession 객체는 접속한 이우에도 제거되지 않고, 지정된 기간동안 살아 있는 객체이다.  
      // <참고> HttpServlet Request,  HttpServlet Response 객체는 접속할때 생성되고, 응답이후 삭제되는 객체이다.
      session.setAttribute( "login_id", login_id );


  }
```
> `HttpServlet Request`, `HttpServlet Response` 객체는 응답하고나서는 사라지지만,     
> `HttpSession` 객체는 사라지지않는다.    

#

`BoardController.java` 의    

`"/boardList.do"` 부분에서,  

`"/boardList.do"` 주소만 치고 들어오는것을 막아주어야 한다.  
> 각 주소마다 로그인 성공여부를 확인하기 위해서,  
> 각 주소해당 코드마다 확인 코드작성은 비효율 적이다.  
> ex) 각 교실마다 외부사람 확인하는 인원배치는 효율적인 것.  

```java
  @RequestMapping( value = "/boardList.do" )
  public ModelAndView getBoardList(
  
      // --------------------------------------------------
      // 파라미터 값을 저장하고 있는 BoardSearchDTO 객체를 받아오는 매개변수 선언
      // --------------------------------------------------
      BoardSearchDTO boardSearchDTO
      

// ======================================
// 위쪽 코드는 위치 확인용코드
// 아래부터 새 코드작성.
// ======================================
      

      , HttpSession session
      // 세션 추가하고, import 해주기.

  ){

      // ***************************************
      // 로그인 성공 여부 확인하기
      // ***************************************
      // HttpSession 객체 저장된 로그인 아이디를 꺼내기.  
      String login_id = (String)session.getAttribute("login_id");
      // 만약 login_id 변수 안에 null 이 저장되어 있으면  
      // 즉, 만약 로그인에 성공한 적이 없으면  
      if( login_id==null ){
          
          ModelAndView mav = new ModelAndView();
          mav.setViewName("error.jsp");
          return mav;

      }
```
> 각 메소드 마다 이것을 지정하는것이 비효율적이다.  

#

`logout.jsp` 생성하기.  

```html
<script>

	alert("로그인하고 접속해야 합니다. \n로그인 하십시오!!!!!");
	location.replace("/loginForm.do")

</script>
```

#

----
### `11:30~`

중복된 코드를 피하기위해서, 위에서 작성했던 

`BoardController.java` 의,  
`로그인 성공 여부 확인하기` 코드를 주석처리 하고,  

`@Controller` 부분 하단에서 메소드 작성.  

```java
  // mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
  // @RequestMapping 이 붙은 메소드가 호출되기 전에 호출되는 메소드 선언  
  // @ModelAttribute 가 붙은 메소드는 @RequestMapping 이 붙은 메소드가 호출되기 전에 호출되는 메소드이다.    
  // mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
  @ModelAttribute
  public void checkLogin(
      HttpSession session
  ){
      // ***************************************
      // 로그인 성공 여부 확인하기
      // ***************************************
      // HttpSession 객체 저장된 로그인 아이디를 꺼내기.  
      String login_id = (String)session.getAttribute("login_id");
      // 만약 login_id 변수 안에 null 이 저장되어 있으면  
      // 즉, 만약 로그인에 성공한 적이 없으면  
      if( login_id==null ){

          throw new Exception();

      }
  }
```






----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`

게시판 소스 추석 전 까지 완성될 예정.    

연휴 때 게시판 소스 많이 반복해서 분석하기.  