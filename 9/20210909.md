# 2021년 9월 9일 [81일차]

## # 오전수업
----
### `09:30~`

single 정렬. 진도 예정.    

Sort 는 필수기능.  

#

### # Single Sort 기능 구현.  

`boardList2.jsp` 에서 시작.   

`등록일` `<th>` 태그에,  

`<span>`태그로 끌어안고,  

클래스값, 클릭모양 변경 주기,  

```jsp
<th>번호</th><th>제목</th><th>작성자</th><th>조회수</th><th><span class="reg_date" style="cursor: pointer;">등록일</span></th></tr>
```
> `<span>` 안에서 클릭 활성화 안해주고,  

> `$(".reg_date").css("cursor", "pointer");` `.ready()` 아래에 작성해주어도 같은 기능이다.   

#

`<span>` 의 style 은 지워주고 `.ready()` 아래에 코드 작성해주기.  

```javascript
// *****************************************
// body 태그 안의 내용을 모두 읽어들인 이후 실행할 자스 코드 설정하기  
// *****************************************
$(document).ready(function(){

    changeBgColor(); //common.jsp 파일에서 수입하는 함수.


    $(".reg_date").css("cursor", "pointer");
    // --------------------------------------------
    $(".reg_date").click(function(){

        // alert("등록일 정렬 클릭 테스트 확인!");

        var obj = $(this); 
        var text = obj.text();  
        text = $.trim(text); 


        if( text.indexOf("▲")>=0 ){
            $(".sort").val(""); // 쿼리 일부가 들어감.  

        }
        else if( text.indexOf("▼")>=0 ){
            $(".sort").val("reg_date asc"); // 쿼리 일부가 들어감.  


        }
        else{
            // alert("else 에 걸림.")
            $(".sort").val("reg_date desc"); // 쿼리 일부가 들어감.  
            // obj.append("▼")

        }
    });
    // --------------------------------------------

});
```
> `indexOf()` 연산자와 쓰여서 데이터가 있나 없나 확인 가능.  

> `내림차순` 이면 최신의 날짜가 나와야 한다.
> `오름차순` 이면 오래된 날짜가 나와야 한다.  
> `쿼리`를 `val 값`에 담아서 날리면 된다.  



`boardListForm` 폼태그 안에 히든태그가 있어야 한다.  
```jsp
<input type="hidden" name="sort" class="sort" value="">
```
> 등록일 정렬 기준이 들어가야한다.  

#

----
### `10:30~`

`BoardSearchDTO.java` 에서,      

아래 코드 추가하고,   

```java
private String sort;   
```
> `getter` `setter`  설정 해주기.    

#

`mapper_board.xml` 에서,  

`getBoardList` 부분 쿼리,  

```xml
order by 
    <if test="sort==null or sort.length()==0">
        group_no desc
        ,print_no asc
    </if>
    <if test="sort!=null and sort.length()>0">
        #{sort}
    </if>
```
> `#{}` 이면 양쪽에 싱글쿼트를 붙여서 나오게 한다.   
> 그러므로, `${}` 이 맞다.  

#

여기까지 하면 한번만 작동하고 작동이 안된다.     

비동기 방식으로 HTML 소스로 다시 덮어 씌웠기 때문.    

HTML 소스에는 이벤트가 걸려있지 않아서.   

`boardList2.jsp` 에서,    

```javascript
// *****************************************
// body 태그 안의 내용을 모두 읽어들인 이후 실행할 자스 코드 설정하기  
// *****************************************
$(document).ready(function(){

    changeBgColor(); //common.jsp 파일에서 수입하는 함수.

    // --------------------------------------------
    xxx();
    // --------------------------------------------

});

function xxx(){

  $(".reg_date").css("cursor", "pointer");
  
  $(".reg_date").click(function(){

        // alert("등록일 정렬 클릭 테스트 확인!");

        var obj = $(this); 
        var text = obj.text();  
        text = $.trim(text); 


        if( text.indexOf("▲")>=0 ){
            $(".sort").val(""); // 쿼리 일부가 들어감.  

        }
        else if( text.indexOf("▼")>=0 ){
            $(".sort").val("reg_date asc"); // 쿼리 일부가 들어감.  


        }
        else{
            // alert("else 에 걸림.")
            $(".sort").val("reg_date desc"); // 쿼리 일부가 들어감.  
            // obj.append("▼")

        }

        search();
    });
}
```
> 함수로 따로 빼고 호출해야 한다.    
> 함수로 호출 시키는 이유는,  
> 반복적으로 호출하기 위함.  

> 그 후, `ajax` 의 `success` 부분에 `xxx();` 함수를 추가한다.  

> `xxx();` 함수 이름을 `reg_date_sort()` 로 바꾸어 주기.  

#

여기까지 하면 클릭할때 `▲▼` 가 보이지 않는다.  

보이게 하기 위해서.   

`ajax` 부분의,   

`success`에서,  
`reg_date_sort();` 함수 아래에,  

추가 코딩 해야한다.    

```javascript
  reg_date_sort();
  var sort = $(".sort").val();
  if(sort=="reg_date asc"){
      $(".reg_date").append("▲");
  }
  else if(sort=="reg_date desc"){
      $(".reg_date").append("▼");
  }
  else{
      $(".reg_date").append("");
  }
```

#

----
### `11:30~`

이전시간까지 했던 내용 주석달기.    

등록일 정렬.    
일반 게시판엔 이런기능은 잘 없다.      
고객 요구에 따라서 다르다.   

#

검색화면 배치 변경.  

행보기, 총개수 옆에 배치되도록 변경.  

`form 태그`를 벗어나버리게 된다.  

해결 방법은,  

form 태그 영역을 넓히면 된다.    

#

검색버튼, 모두검색버튼 재배치.  

#

### # 쌍키워드 기능 구현

`boardList2.jsp` 에서,  

`boardListForm` form 태그 위치에서 추가 코딩.  

```jsp
<!-- 과제 -->
<select name="orAnd" class="orAnd">
    <option value="or" selected>or</option>
    <option value="and">and</option>
</select>

<!-- 쌍키워드 -->
<input type="text" name="keyword2" class="keyword2" > 
```

#

----
### `12:30~`

`BoardSearchDTO` 에서,  

`orAnd`, `keyword2` 값 넣고,  

```java
private String keyword2;

private String orAnd="or";
```
> getter, setter 넣기.  

#

`boardList2.jsp` 에서,   
`search()` 함수 유효성 체크,  

keyword2 것도 만들어주기, 복붙,    

```javascript
// -----------------------------------------------
// 입력한 키워드 얻어오기
// 만약 키워드가 비어있거나 공백으로 구성되어 있으면 "" 로 대체하기
// 입력한 키워드의 앞뒤 공백 제거하고 다시 입력 양식에 넣어주기
// -----------------------------------------------
var keyword2 = $(".keyword2").val();

if( keyword2==null || keyword2.split(" ").join("")=="" ){

    keyword2 = "";
    
    // 개발 과정 중 테스트 코드.  
    // alert("[키워드] 가 비어 있어 검색 불가능합니다.") // 경고 띄우기
    // $(".keyword2").val(""); // 길이없는 데이터 입력양식값에 넣고
    // $(".keyword2").focus(); // 커서 들어가있게 하기
    // return;  // 함수 중단.  

}
$(".keyword2").val(  $.trim(keyword2)  );
```

#

`mapper_board.xml` 에서,  

```xml
<if test="keyword1!=null and keyword1.length()>0 or keyword2!=null and keyword2.length()>0">
    and(
</if>  

    <if test="keyword1!=null and keyword1.length()>0">
        (       
            upper(subject) like upper('%${keyword1}%')
            or upper(content) like upper('%${keyword1}%')
            or upper(writer) like upper('%${keyword1}%')
            or upper(email) like upper('%${keyword1}%')
            or to_char(reg_date, 'YYYY-MM-DD') like '%${keyword1}%'
            or to_char(reg_date, 'YYYYMMDD') like '%${keyword1}%'
            or to_char(reg_date, 'YYYY/MM/DD') like '%${keyword1}%'
            or to_char(reg_date, 'YYYY,MM,DD') like '%${keyword1}%'
        )
    </if>  

<if test="keyword1!=null and keyword1.length()>0 and keyword2!=null and keyword2.length()>0">
    ${orAnd}
</if>  


    <if test="keyword2!=null and keyword2.length()>0">
        (
            upper(subject) like upper('%${keyword2}%')
            or upper(content) like upper('%${keyword2}%')
            or upper(writer) like upper('%${keyword2}%')
            or upper(email) like upper('%${keyword2}%')
            or to_char(reg_date, 'YYYY-MM-DD') like '%${keyword2}%'
            or to_char(reg_date, 'YYYYMMDD') like '%${keyword2}%'
            or to_char(reg_date, 'YYYY/MM/DD') like '%${keyword2}%'
            or to_char(reg_date, 'YYYY,MM,DD') like '%${keyword2}%'
        )
    </if>  

<if test="keyword1!=null and keyword1.length()>0 or keyword2!=null and keyword2.length()>0">
    )
</if>  
```

#

`boardList2.jsp` 에서,  

모두검색 기능 정확하게 구현하기.  

```javascript
// *****************************************
// [모두 검색] 버튼 클릭하면 호출되는 함수선언
// *****************************************
function searchAll(){
    // ---------------------------------
    // 키워드1 입력 양식에 "" 넣어주기
    // 키워드2 입력 양식에 "" 넣어주기
    // class=day 를 가진 입력 양식의 체크 풀기
    // ---------------------------------
    $(".keyword1").val("");
    $(".keyword2").val("");
    $(".day").prop("checked", false);
    // ---------------------------------
    // 비동기 방식으로 웹서버에 접속하는 searchExe() 함수 호출하기
    // ---------------------------------
    searchExe();
}
```
> 주의, 모두검색에서, `orAnd` 는 풀면 안된다.    

#

자스쪽에서 짜고,  

히든태그에 where 절 쿼리를 모두 담아서,  

넘기게 되면 mapper 쪽 쿼리가 아주 단순해진다.  

나중에 시간되면 시도 해보기.    

#


----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`
