# 2021년 9월 14일 [84일차]

## # 오전수업
----
### `09:30~`

<복습>   

파일업로드와 데이터베이스에 파일 이름이 맞물려 진행된다.      

업무적 특징에 따른 로직.   

#

체크박스 선택하면 이미지 삭제 되는 수정 기능 만들기.  

`boardUpDelForm.jsp` 에서,  

```jsp
<input type="checkbox" name="is_del" class="is_del" value="yes">이미지파일 삭제 (이미지 파일을 삭제할때 클릭하세요)

```
> 체크박스 추가하기.  

#

`BoardDTO.java` 에서,  

```java
private String is_del;
```
> 추가하고, getter setter 추가하기.  

#

`BoardServiceImpl.java` 에서,  

```java
  // ---------------------------------------
  // 업로드한 파일의 새로운 이름정하기
  // ---------------------------------------
  // 업로드한 파일의 파일확장자 포함 새 파일명 저장변수 선언하기. 파일명에는 확장자가 포함한다.  
  String newFileName = null;
  String is_del = boardDTO.getIs_del();

  System.out.println("BoardServiceImpl.java 에서, getIs_del 값 확인 -====>" + is_del);

  // 만약 업로드된 파일이 있으면 
  if( multi!=null && multi.isEmpty()==false && is_del==null ){
      // 업로드한 파일의 원래 파일명 얻기. 파일명에는 확장자가 포함한다.  
      String oriFileName = multi.getOriginalFilename();
      // 업로드한 파일의 파일 확장자 얻기
      String file_extension = oriFileName.substring( oriFileName.lastIndexOf(".")+1 );

      // 고유한 새 파일명 얻기. 파일명에는 확장자가 포함한다. 
      newFileName = UUID.randomUUID() + "." + file_extension;
      // boardDTO 객체에 새로운 파일명 저장하기.
      boardDTO.setPic(newFileName);
  }
  // --------------------------------------
  // board 테이블에 있는 기존 이미지 이름 가져오기
  // --------------------------------------
  String pic = this.boardDAO.getPic(boardDTO);

  /*
  // --------------------------------------
  // 만약에 삭제가 체크되어 있고, 기존 이미지 파일 명이 board 테이블에 존재하면,  
  // --------------------------------------
  if( is_del!=null && pic!=null ){
      // board 테이블에 이미지파일 이름을 삭제하기  
      int picDelCnt = this.boardDAO.delPic(boardDTO);
  }
  */




//============================
// 위쪽 코드 부분 추가하기. 
// is_del 변수 선언해서 DTO 에서 꺼내 넣고 조건주기.  
//============================




  // ---------------------------------------
  // 파일 업로드 하기
  // ---------------------------------------
  if( is_del==null ){
      // 만약 업로드된 파일이 있으면 
      if( multi!=null && multi.isEmpty()==false && is_del==null ){
          // ---------------------------------------
          // 기존 이미지 파일 삭제 하기
          // ---------------------------------------
      
          // board 테이블에 이미지 이름이 있으면 파일 삭제하기 
          if(pic!=null && pic.length()>0){
              File file = new File( uploadDir + pic);
              file.delete();
          }
          // 새 파일을 생성하기 File 객체를 생성하면 새 파일을 생성할 수 있다.  
          File file = new File( uploadDir + newFileName );
          // 업로드한 파일을 새 파일에 전송하여 덮어쓰기
          multi.transferTo(file);
      }
  } else{
      if( pic!=null ){
          
          File file = new File( uploadDir + pic);
          file.delete();

      }
  }


//============================
// 위 파일 업로드 부분 추가하기.
// 체크가 되어있으면, 파일 삭제 되도록 else 추가.  
//============================


```
> 파일업로드가 있건 없건간에 이미지삭제 체크박스 선택되어 있으면 삭제되도록 해야 한다.  
> 파일 삭제하는것은 DB 연동 후에 해야 한다.  
> 새로운 파일 선택하고 맘이 바뀌어서 삭제 체크를 할 수 있기 때문.   
> 삭제 체크가 되어 있으면 PIC 에는 아무것도 날라가지 않아야 한다.  
> 파일만 지우지 말고, 오라클에 이미지 명을 지워야 한다.  

> 삭제가 체크 되어 있으면 기존의 파일 이름이 DB 에서 null 로 업데이트가 되어야 한다.  

#


`mapper_board.xml` 에서,  

```xml
<!-- ********************************************************************* -->
<!-- 게시판 수정하는 update 을 내포하는 update 태그 선언 -->
<!-- ********************************************************************* -->
<update id="updateBoard" parameterType="com.naver.erp.BoardDTO">

    update 
        board 
    set 
        subject=#{subject}
        ,writer=#{writer}
        ,content=#{content}

        <if test="is_del!=null and is_del.length()>0">
        ,pic=null
        </if>

        <if test="is_del==null or is_del.length()==0">
            <if test="pic!=null and pic.length()>0">
            ,pic=#{pic}
            </if>
        </if>

        ,email=#{email}
    where 
        b_no=#{b_no}
        and
        pwd=#{pwd}

</update>
```
> pic 을 null 로 덮어 씌운다.  
> 삭제 체크가 되어있을 경우와 체크 안되어있는 경우를 조건 주어서 pic 업데이트를 한다.    

#

----
### `10:30~`








----
### `11:30~`








----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`
