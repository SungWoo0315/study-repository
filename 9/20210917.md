# 2021년 9월 17일 [87일차]

## # 오전수업
----
### `09:30~`

<어제복습>

#

<진도>  

## <게시판 흐름 분석>

새글쓰기부분부터 흐름리뷰.  

클라이언트가 받은 HTML 은 javascript 도 포함되어 있다.  

서버쪽에서 javascript 가 실행되는것은 node.js 이다.  

#

새글쓰기 클릭하면 실행되는,  

`goBoardRegForm()` 함수,  

새글쓰기는 아무값도 가져갈 필요 없기 때문에,  
아래코드처럼,  
`location.replace()`를 쓴다.  

```javascript
location.replace('/${requestScope.naverPath}boardRegForm.do');
``` 

#

`BoardController.java` 에서,  

`@RequestMapping( value = "/boardRegForm.do" )` 부분으로 넘어 온다.  

```java
@RequestMapping( value = "/boardRegForm.do" )
public ModelAndView goBoardRegForm(
    // ---------------------------------------------------------------
    // 파라미터명이 b_no 인 파라미터값을 받아오는 매개변수 b_no 선언하기
    // ---------------------------------------------------------------
    @RequestParam(
        value="b_no"            // 파라미터명 설정
        , required = false      // 파라미터명, 값이 안들어와도 허용한다는 의미
        , defaultValue = "0"    // 파라미터값 없으면 파라미터값을 0으로 저장
        ) int b_no

    // HttpServletRequest request

)
```
> 댓글쓰러 올때와, 새글쓰러 올때 두가지 경우여서,  
> `required` 와,  
> `defualtValue` 가 필요하다.  
> 새글쓰러 올때는 파라미터값이 없이 들어오기 때문.  
> 댓글쓰러 올때만 `b_no` 가지고 오기때문.  
> 만약 `required` 와 `defualtValue` 가 없다면,  
> `value="b_no"` 가 반드시 들어가야해서,  
> `b_no` 가 없으면 에러가 나기 때문.  

`BoardController.java` 에서,    
들어올때 처음 DB 연동하는것은?   

최상단의,  총개수 구하는 코드이다.    
```java
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
// @RequestMapping 이 붙은 메소드가 호출되기 전에 호출되는 메소드 선언  
// @ModelAttribute 가 붙은 메소드는 @RequestMapping 이 붙은 메소드가 호출되기 전에 호출되는 메소드이다.    
// @ModelAttribute("키값명")이 붙은 메소드가 리턴하는 데이터는
// 스프링이 HttpServletRequest 객체에 setAttribute( "키값명", 리턴데이터 ) 메소드를 호출하므로
// @RequestMapping(~)이 붙은 메소드 호출 후에 이동하는 JSP 페이지에서 ${requestScope.키값명}으로 꺼낼 수 있다.  
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
@ModelAttribute("totCnt")
public int getTotCnt( BoardSearchDTO boardSearchDTO ){
    int totCnt = this.boardDAO.getBoardListCount( boardSearchDTO );

    return totCnt;
}
```
> 컨트롤러에 접근할때마다 총개수가 갱신된다.  

#

`boardRegForm.jsp` 로 이동해서,  

jsp 는 서버에서 실행되는것이다.  

javascript 와 html 만 클라이언트에 가서 표기가 된다.  

컨트롤러에서 넘긴 파라미터값 b_no 을 받아서,  
제일먼저 새글쓰기인지 댓글쓰기인지 표현한다.  

```jsp
<c:choose>
    <c:when test="${empty param.b_no}">
        <caption>[[새글쓰기]]</caption>
    </c:when>
    <c:otherwise>
        <caption>[[댓글쓰기]]</caption>
    </c:otherwise>
</c:choose>
```
> 파라미터값이 있을 때 댓글쓰기로 들어간다.  

`${thBgColor}` 의 의미는?  
```jsp
<th bgcolor="${thBgColor}">이  름</th>  
```
> `HttpservletRequest 객체` 혹은,    
> `HttpSesstion 객체` 안을 찾는데,    

> `HttpservletRequest 객체`의 키값 `thBgColor` 를 찾는다.     
> 이 키값은 `common.jsp` 에서 키값을 추가한 것이다.    

----
### `10:30~`

`boardRegForm.jsp` 이어서,  

리셋버튼은 전용버튼,  
폼태그 안에서 입력양식을 모두 초기화 하는 기능  

저장버튼을 누르면,  

`checkBoardRegForm()` 함수 실행된다.  

ajax 로 넘어가서 그 안의 코드들이 실행된다.  

웹서버가 원래는 html 로 응답하지만,  

여기서는 json 으로 받는다.  

#

`BoardController.java` 에서,    
아래 코드쪽으로 이동한다.   

```java
@RequestMapping( 
        value="/boardRegProc.do"
```

유효성 체크는 서버단에서 실행한다.  

입력양식들의 입력값을 `BoardDTO` 에 담아 들어온다.  

`BoardDTO` 에서는 파일은 못받는다.  
파일 이름만 `pic` 에 저장한다.  

파일 받는것은,  
`,@RequestParam("img") MultipartFile multi` 이 코드이다.    

유효성 체크 관리하는 객체,  

`BindingResult` 객체,  
이 객체가 나오면 유효성체크가 나온다.  
> 서버단에서 유효성체크를 하기 위해.    
> 보안을 위해,    

```
자바스크립트에서 파일용량을 체크 할 수 있다.  
서버로 못보내게 설정 가능하다.  
```

유효성체크와 파일 업로드 수행은   
아래코드에서 수행하고,  
리턴한다.  
```java
boardRegCnt = this.boardService.insertBoard(boardDTO, multi); 
```
> `boardService` 쪽  `insertBoard`메서드 에서 `boardDAO` `insertBoard` 들어가서 새글등록 및 파일 업로드 수행으로 넘어간다.  

#

그리고 다시,  

`boardRegForm.jsp` 이어서,     
리턴을,    

`json` 으로 받아서,   

새글쓰기 성공하고,     

`"/${requestScope.naverPath}boardList.do"` 로 이동하게 한다.      

#

파일 업로드와 트랜잭션이 연관되어야 한다.  

insert가 안되면, 파일업로드도 실행이 안되어야한다.  

#

`BoardServiceImpl.java` 에서,    

`insertBoard()` 메서드 쪽,  

파일 업로드는,  

DB 연동 후에 업로드 하는것이 좋다.  

트랜잭션이 함께 작동되도록하는것이다.  

----
### `11:30~`



















----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`

추석때 교실사용 안내.    

오전 8시 ~ 오후 9시   

월화수 추석기간동안   

입실자는 과장님한테 입실카톡하기.  

마지막 퇴실자는 나오기전에 전화 하기.  

에어컨 종료 및 교실정리 주의하기.  


