# 2021년 9월 10일 [82일차]

## # 오전수업
----
### `09:30~`

추석전까지,   

<게시판 소스 분석>       

추석 전까지 파일업로드 추가된 게시판.  

게시판 소스 분석.    

#

<복습>    

페이징처리 관련 숫자 `Util.java` 로 공용으로 빼주고,    
메소드 작업.    

#

페이징 처리 로직,     
공용함수처리,  

`Util.java`에서,  

```java
// --------------------------------------------
// 페이징 처리 관련 정수 데이터를 구하고 Map<String,Integer> 객체에 저장하여 
// Map<String,Integer> 객체 메소드 선언  
// --------------------------------------------
public static Map<String,Integer> getPagingNos(
    int totCnt              // 검색 결과물에 총 개수.  
    ,int selectPageNo       // 유저가 선택한 페이지 번호
    ,int rowCntPerPage      // 한 화면에 보여줄 [행]의 개수  
    ,int pageNoCntPerPage   // 한 화면에 보여줄 [페이지번호]의 개수   
)throws Exception{
    // **********************************
    // [마지막 페이지번호] 저장 변수선언
    // 현재 페이지에서 보여줄 [최소 페이지 번호]
    // 현재 페이지에서 보여줄 [최대 페이지 번호]
    // **********************************
    int last_pageNo = 0;  
    int min_pageNo = 0;  
    int max_pageNo = 0;  
    // ----------------------------------
    // 검색 결과물의 총개수가 0보다 크면   
    // ----------------------------------
    if( totCnt>0 ){
        // 마지막 페이지 번호 구하기  
        last_pageNo = totCnt/rowCntPerPage;
            if( totCnt%rowCntPerPage > 0 ){last_pageNo++;}
  
            // 만약 선택한 페이지 번호가 마지막 페이지 번호보다 크면 선택한 페이지 번호를 1로 보정하기.    
            if( selectPageNo > last_pageNo ){
                // selectPageNo 변수에 1 저장하고,
                selectPageNo = 1;
            }
        // 현재 페이지에서 보여줄 [최소 페이지 번호] 구하기  
        min_pageNo = (selectPageNo - 1)/pageNoCntPerPage * pageNoCntPerPage + 1;
        // 현재 페이지에서 보여줄 [최대 페이지 번호] 구하기  
        max_pageNo = min_pageNo + pageNoCntPerPage - 1;
            if( max_pageNo > last_pageNo ) { max_pageNo = last_pageNo; }
  
    }
    // ----------------------------------
    // HashMap 객체 생성하기
    // ----------------------------------
    Map<String,Integer> map = new HashMap<String,Integer>();
    // ----------------------------------
    // HashMap 객체에 마지막 페이지 번호 저장하기
    // HashMap 객체에 현재 페이지에서 보여줄 [최소 페이지 번호]
    // HashMap 객체에 현재 페이지에서 보여줄 [최대 페이지 번호]
    // HashMap 객체에 선택한 페이지 번호 저장하기
    // HashMap 객체에 한 화면에 보여줄 [행]의 개수 저장하기
    // HashMap 객체에 한 화면에 보여줄 [페이지 번호]의 개수 저장하기
    // ----------------------------------
    map.put("last_pageNo", last_pageNo);
    map.put("min_pageNo", min_pageNo);
    map.put("max_pageNo", max_pageNo);
    map.put("selectPageNo", selectPageNo);
    map.put("rowCntPerPage", rowCntPerPage);
    map.put("pageNoCntPerPage", pageNoCntPerPage);
    // ----------------------------------
    // HashMap 객체 리턴하기
    // ----------------------------------
    return map;
}
```
> 선택페이지 보정 저장 `boardSearchDTO` 는 공용적 성격상 빼야한다.  

> 예외처리가 안되어있다.  
> `try~catch~final` 적용 할 시간이 없으면,  
> 매개변수 `)` 다음에, `throws Exception` 적용하기.    
> 예외처리를 떠넘기는것. 호출한쪽에서 처리하도록.  
> 예외처리할때 호출한쪽에서 처리하도록 넘기는것이다.  

#

바깥에서 데이터 들어오는것,  
java 스트림.     
파일 복사 업로드 객체,  
파일 업로드 코딩이 나오면,  
**반드시** `예외처리` 해야 한다.    

#

`BoardController.java` 에서,   
공용함수 쓰는법.  

```java
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
// 공용함수 Util.java 꺼내서 쓰는법. 
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
public ModelAndView getBoardList2(
    // --------------------------------------------------
    // 파라미터 값을 저장하고 있는 BoardSearchDTO 객체를 받아오는 매개변수 선언
    // --------------------------------------------------
    BoardSearchDTO boardSearchDTO
){

    // ***************************************
    // 검색 조건에 맞는 [게시판 목록의 총개수] 얻기
    // ***************************************
    int getBoardListCount = this.boardDAO.getBoardListCount( boardSearchDTO );
    int selectPageNo = boardSearchDTO.getSelectPageNo();
    int rowCntPerPage = boardSearchDTO.getRowCntPerPage();
    int pageNoCntPerPage = 10;
    // ***************************************
    Map<String,Integer> map = Util.getPagingNos(
    getBoardListCount              // 검색 결과물에 총 개수.  
    ,selectPageNo       // 유저가 선택한 페이지 번호
    ,rowCntPerPage      // 한 화면에 보여줄 [행]의 개수  
    ,pageNoCntPerPage   // 한 화면에 보여줄 [페이지번호]의 개수   
    );
    boardSearchDTO.setSelectPageNo(map.get("selectPageNo"));
    // ***************************************
    // 오라클 board 테이블 안의 데이터를 검색해와 자바 객체에 저장하기 즉, [게시판 목록] 얻기
    // 검색 조건에 맞는 [게시판 목록] 얻기
    // ***************************************
    List<Map<String, String>> boardList = this.boardDAO.getBoardList( boardSearchDTO );
    // ***************************************
    ModelAndView mav = new ModelAndView();
    mav.setViewName("boardList2.jsp");
    mav.addObject("boardList", boardList);
    mav.addObject("getBoardListCount", getBoardListCount);
    mav.addObject("pagingNos", map);  
    // 해시맵 객체로 저장. EL로 꺼내려면. ${pagingNos.selectPageNo}, ${pagingNos.min_pageNo}
    
    // ***************************************
    // [ModelAndView 객체] 리턴하기
    // ***************************************
    return mav;
}
```
> 공용으로 빼주고 난 다음에는   
> `boardList2.jsp` 에서,  페이지 번호 관련 코드에서   
> `pagingNos` 를 EL 쪽에 추가해야한다.  
> `${requestScope.pagingNos.min_pageNo}` 이런식으로 다 수정해야 한다.  


#

----
### `10:30~` `11:30~` 이어서.

`BoardController.java` 에서,   
공용함수 간략화 및 주석달기.  

```java
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
// 공용함수 Util.java 꺼내서 쓰는법.
//  
// 위 getBoardList 메소드 안의 내용을 심플하게 줄인 메소드
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
public ModelAndView getBoardList2(
    // --------------------------------------------------
    // 파라미터 값을 저장하고 있는 BoardSearchDTO 객체를 받아오는 매개변수 선언
    // --------------------------------------------------
    BoardSearchDTO boardSearchDTO
){
    // ***************************************
    // 검색 조건에 맞는 [게시판 목록의 총개수] 얻기
    // ***************************************
    int getBoardListCount = this.boardDAO.getBoardListCount( boardSearchDTO );
    // ***************************************
    // 페이징 처리 관련 번호가 저장된 HashMap<String,Integer> 객체 구하기
    // ***************************************
    Map<String,Integer> map = Util.getPagingNos(
        getBoardListCount                       // 검색 결과물에 총 개수.  
        ,boardSearchDTO.getSelectPageNo()       // 유저가 선택한 페이지 번호
        ,boardSearchDTO.getRowCntPerPage()      // 한 화면에 보여줄 [행]의 개수  
        ,10                                     // 한 화면에 보여줄 [페이지번호]의 개수   
    );
    // HashMap<String,Integer> 객체에 저장된 보정된 선택 페이지 번호를
    // boardSearchDTO 객체에 setSelectPageNo 메소드 호출로 덮어 씌우기  
    boardSearchDTO.setSelectPageNo(map.get("selectPageNo"));
    // ***************************************
    // 검색 결과물 얻기
    // ***************************************
    List<Map<String, String>> boardList = this.boardDAO.getBoardList( boardSearchDTO );
    // ***************************************
    // ModelAndView 객체 생성하기
    // ModelAndView 객체에 검색 결과물 저장하기
    // ModelAndView 객체에 검색 결과물 총개수 저장하기
    // ModelAndView 객체에 페이징 처리 관련 번호가 저장된 HashMap<String,Integer> 객체 저장하기
    // [ModelAndView 객체] 리턴하기
    // ***************************************
    ModelAndView mav = new ModelAndView();
    mav.setViewName("boardList2.jsp");
    mav.addObject("boardList", boardList);
    mav.addObject("getBoardListCount", getBoardListCount);
    mav.addObject("pagingNos", map);  
    // 해시맵 객체로 저장. EL로 꺼내려면. ${pagingNos.selectPageNo}, ${pagingNos.min_pageNo}
    // ***************************************
    return mav;
}
```

#

비동기방식으로,   

HTML 방식으로 받는게 아니라,    

DB에서 직접 받는식으로 할수도 있다.  

`loginProc2.jsp` 가 필요없어진다.  

jsp 거쳐서 받아오는식이 아닌,  

다른방식 코딩수정.  

DB 결과물을 직접 받는법.   

#

`LoginController.java` 에서,  
추가 코딩  

```java
// ********************************************
// 가상주소 /loginProc3.do 로 접근하면 호출되는 메소드 선언
// 메소드 앞에 @RequestMapping(~,~,produces = "application/json;charset=UTF8") 하고
// @ResponseBody 가 붙으면 리턴하는 데이터가 클라이언트에게 전송된다.  
// ModelAndView 객체를 리턴하면 JSP 를 호출하고 그 JSP 페이지의 실행결과인 HTML 문서가 응답 메시지에 저장되어 전송되지만  
// @RequestMapping(~) 와 @ResponseBody 가 붙으면 리턴하는 데이터가 JSON 형태로 응답메시지에 저장되어 전송된다.  
// ********************************************
// 아래 코드 원본과 loginProc() 매서드 매개변수가 달라진 코딩이다.  
@RequestMapping( 
    value="/loginProc3.do"
    ,method = RequestMethod.POST
    ,produces = "application/json;charset=UTF8"
)
@ResponseBody
public int loginProc3(
    // ---------------------------------------
    // "login_id" 라는 파라미터명에 해당하는 파라미터값을 꺼내서 매개변수 login_id 에 저장하고 들어온다.
    // ---------------------------------------
    @RequestParam( value="login_id" ) String login_id 
    // ---------------------------------------
    // "pwd" 라는 파라미터명에 해당하는 파라미터값을 꺼내서 매개변수 pwd 에 저장하고 들어온다.
    // ---------------------------------------
    ,@RequestParam( value="pwd" ) String pwd

    // ---------------------------------------
    // "is_login" 라는 파라미터명에 해당하는 파라미터값을 꺼내서 매개변수 is_login 에 저장하고 들어온다.
    // ---------------------------------------
    ,@RequestParam( value="is_login", required = false ) String is_login


    // ---------------------------------------
    // HttpSession 객체의 메위주를 저장하는 매개변수 session 선언하기
    // ---------------------------------------
    ,HttpSession session
    // ---------------------------------------
    // [HttpServletResponse객체] 가 들어올 매개변수 선언
    // ---------------------------------------
    ,HttpServletResponse response
  ){

    // --------------------------------------------------
    // HashMap 객체 생성하기
    // HashMap 객체에 로그인 아이디 저장하기
    // HashMap 객체에 암호 저장하기
    // --------------------------------------------------
    Map<String,String> map = new HashMap<String,String>();
    map.put("login_id", login_id);
    map.put("pwd", pwd);

    // --------------------------------------------------
    // loginDAOImpl 객체의 getLogin_idCnt 메소드를 호출하여 
    // 로그인 아이디와 암호의 전체 개수 얻기
    // --------------------------------------------------
    System.out.println("LoginController.loginProc 해시맵 객체 => " + map);

    int login_idCnt = loginDAO.getLogin_idCnt(map);

    // --------------------------------------------------
    // 만약 login_idCnt q변수 안의 데이터가 1이면
    // 즉, 만약 입력한 아이디 암호가 DB에 존재하면
    // 즉, 만약 로그인이 성공했으면
    // --------------------------------------------------
    if( login_idCnt==1 ){
        
        // HttpSession 객체에 로그인 아이디 저장하기  
        // HttpSession 객체에 로그인 아이디를 저장하면 재 접속 했을 때 다시 꺼내 볼 수 있다.  
        // <참고> HttpSession 객체는 접속한 이우에도 제거되지 않고, 지정된 기간동안 살아 있는 객체이다.  
        // <참고> HttpServlet Request,  HttpServlet Response 객체는 접속할때 생성되고, 응답이후 삭제되는 객체이다.
        session.setAttribute( "login_id", login_id );

        // -------------------------------------------
        // 매개변수 is_login 에 null 이 저장되어 있으면 (+ [아이디,암호 자동입력]의사 없을 경우 )
        // -------------------------------------------
        if(is_login==null){

            /* 공용함수로 인해서 주석처리.
            // Cookie 객체를 생성하고 쿠키명-쿠키값을 ["login_id"-null]로 하기
            Cookie cookie1 = new Cookie("login_id",null);
            // Cookie 객체 저장된 쿠키의 수명은 0으로 하기
            cookie1.setMaxAge(0);  
            // Cookie 객체를 생성하고 쿠키명-쿠키값을 ["pwd"-null]로 하기
            Cookie cookie2 = new Cookie("pwd",null);
            // Cookie 객체 저장된 쿠키의 수명은 0으로 하기
            cookie2.setMaxAge(0); 

            // Cookie 객체가 소유한 쿠키를 응답메시지에 저장하기.  
            // 결국 Cookie 객체가 소유한 쿠키명-쿠키값이 응답메시지에 저장되는 셈이다.
            // 응답메시지에 저장된 쿠키는 클라이언튼쪽으로 전송되어 클라이언트쪽에 저장된다.  
            response.addCookie(cookie1);
            response.addCookie(cookie2);
            */

            // Util.java 에서 함수 호출해서 사용.  
            Util.addCookie(
                "login_id"
                ,null
                ,0
                ,response
            );
            Util.addCookie(
                "pwd"
                ,null
                ,0
                ,response
            );
            

        } 
        // -------------------------------------------
        // 매개변수 is_login 에 "yes" 가 저장되어 있으면(=[아이디, 암호 자동입력]의사 있을 경우)
        // -------------------------------------------
        else{

            /* 공용함수로 인한 주석처리.
            // -------------------------------------------
            // 클라이언트가 보낸 아이디, 암호를 응답메시지에 쿠키명-쿠키값으로 저장하기. 
            // -------------------------------------------
            // Cookie 객체를 생성하고 쿠키명-쿠키값을 ["login_id"-"입력아이디"]로 하기
            Cookie cookie1 = new Cookie("login_id",login_id);
            // Cookie 객체에 저장된 쿠키의 수명은 60*60*24 로 하기.(하루)
            cookie1.setMaxAge(60*60*24);  

            // Cookie 객체를 생성하고 쿠키명-쿠키값을 ["pwd"-"입력암호"]로 하기
            Cookie cookie2 = new Cookie("pwd",pwd);
            // Cookie 객체에 저장된 쿠키의 수명은 60*60*24 로 하기.(하루)
            cookie2.setMaxAge(60*60*24);  

            // Cookie 객체가 소유한 쿠키를 응답메시지에 저장하기.  
            response.addCookie(cookie1);
            response.addCookie(cookie2);
            */

            // Util.java 에서 함수 호출해서 사용.  
            Util.addCookie(
                "login_id"
                ,login_id
                ,60*60*24
                ,response
            );
            Util.addCookie(
                "pwd"
                ,pwd
                ,60*60*24
                ,response
            );
        }

    }

    System.out.println("LoginController.loginProc login_idCnt 보기 => " + login_idCnt);
    // System.out.println( "login_id => " + login_id ); // 입력된 아이디값 콘솔출력.
    // System.out.println( "pwd => " + pwd );           // 입력된 암호값 콘솔 출력.   

    return login_idCnt;
}
```
> 바로 DB 연동
> DB 연동 결과물을 json 으로 바로 보내는것이다.  
> `@ResponseBody` 붙여주는것이 중요하다.  

#

`loginForm.jsp` 에서,  

`ajax` 부분,  
`success` 의 `responseHTML` 에 HTML 이 아니라 DB 연동값이 넘어오게 된다.  

ajax 부분, `"/loginProc3.do"` 를,  

복붙해서 새로 만들어준다.  

기존 `ajax`, `"/loginProc.do"` 전체코드 부분은 주석처리.  

`MvcConfiguration.java` 에서, `"/loginProc3.do"` 을 등록해주어야 한다.  

```javascript
// ---------------------------------------------------
// 현재 화면에서 페이지 이동 없이(=비동기 방식으로)
// 서버쪽 loginProc.do 로 접속하여 아이디, 암호의 존재 개수를 얻기
// ---------------------------------------------------
// alert($("[name=loginForm]").serialize())  // 테스트. 확인용.  
// return;  // 테스트. 확인용. 
$.ajax(
        {
            // ----------------------------------------------------------
            // 서버쪽 호출 URL 주소 지정
            // ----------------------------------------------------------
            url       : "/loginProc3.do"
            // ----------------------------------------------------------
            // form 태그 안의 입력양식 데이터 즉, 파라미터값을 보내는 방법 지정
            // ----------------------------------------------------------
            ,type     : "post"
            // ----------------------------------------------------------
            // 서버로 보낼 파라미터명과 파라미터값을 설정. 
            // 즉, 입력한 아이디와 암호, 아이디/암호 기억체크여부를 지정
            // ----------------------------------------------------------
            ,data     : $("[name=loginForm]").serialize() 
                // 위 설정은 아래 처럼도 가능
                //"id=" + id + "&pwd=" + pwd
                // ,data : {'id':id, 'pwd':pwd}   // JSON 형태로도 가능.
            // ----------------------------------------------------------
            // 서버의 응답을 성공적으로 받았을 경우 실행할 익명함수 설정.
            // 익명함수의 매개변수에는 서버가 보내온 아이디 암호의 존재 개수가 들어온다.
            // ----------------------------------------------------------
            ,success  : function( idCnt ){
                // ------------------------------------
                // 만약 아이디, 암호의 존재가 1이면, 즉, 존재하면
                // ------------------------------------
                if( idCnt == 1 ){
                    alert("로그인 성공!")	// 테스트용 확인.  
                    location.replace("/boardList.do")
                }
                // ------------------------------------
                // 그렇지 않으면, 즉, 아이디, 암호가 존재하지 않으면
                // ------------------------------------
                else{
                    alert("로그인 실패...")
                }

            }
            // ----------------------------------------------------------
            // 서버의 응답을 못 받았을 경우 실행할 익명함수 설정
            // ----------------------------------------------------------
            ,error    : function( ){
                alert("서버 접속 실패! 관리자에게 문의 바람!");
            }
        }
);
```

#

- 책 추천

  리엑트 책 

  [리엑트를다루는기술](http://www.yes24.com/Product/Goods/78233628)  
  > 개정판을 사야한다.    

#

----
### `12:30~`

## # `Spring+JSP_교재_ver_01.txt` 진도 이어서. 

### # <문12> 답변형 게시판에서 만들어야할 자바 클래스, JSP 페이지는?   

```
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
<문12> 답변형 게시판에서 만들어야할 자바 클래스, JSP 페이지는?
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
============================================================================================================
URL 주소               컨트롤러 클래스                                                             JSP 페이지
============================================================================================================
/loginForm.do          LoginController 클래스의 @RequestMapping("/loginForm.do") 메소드            loginForm.jsp 
------------------------------------------------------------------------------------------------------------
/loginProc.do          LoginController 클래스의 @RequestMapping("/loginProc.do") 메소드            loginProc.jsp (with자바코드)
------------------------------------------------------------------------------------------------------------
/boardList.do          BoardController 클래스의 @RequestMapping("/boardList.do") 메소드            boardList.jsp 
------------------------------------------------------------------------------------------------------------
/baordContentForm.do   BoardController 클래스의 @RequestMapping("/baordContentForm.do") 메소드     baordContentForm.jsp 
------------------------------------------------------------------------------------------------------------
/boardRegForm.do       BoardController 클래스의 @RequestMapping("/boardRegForm.do") 메소드         boardRegForm.jsp 
------------------------------------------------------------------------------------------------------------
/boardRegProc.do       BoardController 클래스의 @RequestMapping("/boardRegProc.do") 메소드         boardRegProc.jsp 
------------------------------------------------------------------------------------------------------------
/boardUpDelForm.do     BoardController 클래스의 @RequestMapping("/boardUpDelForm.do") 메소드       boardUpDelForm.jsp 
------------------------------------------------------------------------------------------------------------
/boardUpDelProc.do     BoardController 클래스의 @RequestMapping("/boardUpDelProc.do") 메소드       boardUpDelProc.jsp 
------------------------------------------------------------------------------------------------------------
/logout.do             LoginController 클래스의 @RequestMapping("/logout.do") 메소드               logout.jsp 
------------------------------------------------------------------------------------------------------------
/login_alert.do        LoginController 클래스의 @RequestMapping("/login_alert.do") 메소드          login_alert.jsp 
------------------------------------------------------------------------------------------------------------

컨트롤러 클래스 
    LoginController 클래스
        로그인 관련 URL 주소로 접근할 때 호출되는 메소드를 소유하고 있다. 
    BoardController 클래스
        게시판 관련 URL 주소로 접근할 때 호출되는 메소드를 소유하고 있다. 
        

서비스 클래스
    BoardServiceImpl 클래스 
서비스 인터페이스 
    BoardService 인터페이스 
DAO 클래스 
    loginDAOImpl 클래스
    BoardDAOImpl 클래스
DAO 인터페이스  
    loginDAO 인터페이스
    BoardDAO 인터페이스
DTO 클래스 
    BoardDTO 클래스 
    BoardSearchDTO 클래스 
JSP 페이지 
    boardList.jsp   
    boardRegForm.jsp   
    boardRegProc.jsp   
    boardUpDelForm.jsp   
    boardUpDelProc.jsp   
    common.jsp   
    error.jsp   
    login_alert.jsp   
    loginForm.jsp   
    loginProc.jsp   
    logout.jsp   
```

#

----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`

다음주는 필요한 메소드들만 남겨놓고 다 코드 정리 할 예정.  