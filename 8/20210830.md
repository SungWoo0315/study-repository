# 2021년 8월 30일 [74일차]

## # 오전수업
----
### `09:30~`

<지난주>   

로그인,    

리스트,    

상세보기,    

수정/삭제,    
> 수정, 삭제 전에 지워진 글에 대한 대비.  
> 암호 일치 확인.  

오늘은 댓글작업하기.    
> 새글쓰기와 비슷함.  

검색빼고 완성이 된다.   

#

### # 댓글쓰기 기능 구현.  

`boardContentForm.jsp` 에서 코딩.  

`goBoardRegFrom()` 함수 만들기.  

```javascript
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
// 게시판 댓글 화면으로 이동하는 함수 선언
// mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
function goBoardRegFrom(){

    // alert("댓글쓰기 확인"); // 테스트용. 버튼 작동 확인.  
    
    // -----------------------------------------
    // name=boardRegForm 을 가진 form 태그의 action 값을 URL로 서버에 접속하라
    // -----------------------------------------
    document.boardRegForm.submit();


    
}


// 맨 아래쪽 이동해서 form 태그 추가.  


<!-- ****************************************************** -->
<!-- [게시판 댓글쓰기] 화면으로 이동하는 form 태그 선언 -->
<!-- ****************************************************** -->
<form name="boardRegForm" method="POST" action="/boardRegForm.do">
    <input type="hidden" name="b_no" value="<%=b_no%>">
</form>


```
> 게시판 댓글 화면으로 이동하는 함수    
> 작성된 페이지가 댓글로 들어가야 한다.    

> 댓글화면 이동방법 두가지,    

> `location.relpace("/xxx.do")`    
> 이렇게 이동하면 데이터를 갖고 이동하기 힘들다.    
> 방법은 있다. (get 방식)   
> `location.relpace("/xxx.do?a=b&c=d")`  
> `?` 뒤에 파라미터명과 파라미터 값을 붙여주면 된다.  
> 파라미터명과 파라미터값 보안 때문에 위험하다.  
> ![get방식이동](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210830%200951_get%EB%B0%A9%EC%8B%9D_.png)     

> form 태그 입력 양식을 POST 방식으로 보내는법,    
> `document.폼태그name값.submit();`    

> 댓글쓰기도 `boardRegForm.do` 를 활용한다.  
> 새글쓰기와 다른점은, 
> PK 번호를 들고 간다는것이다.  
> 새글쓰기는 PK 번호 활용 안함.  

#


`BoardController` 에서,     
`"/boardRegForm.do"` 찾고, 이어서 코딩.  

댓글페이지로 이동하게 하기,    
부모글 PK 번호 활용.    

```java
// ---------------------------------------------------------------
// 파라미터명이 b_no 인 파라미터값을 받아오는 매개변수 b_no 선언하기
// ---------------------------------------------------------------
@RequestParam(
    value="b_no"            // 파라미터명 설정
    , required = false      // 파라미터명, 값이 안들어와도 허용한다는 의미
    , defaultValue = "0"    // 파라미터값 없으면 파라미터값을 0으로 저장
    ) int b_no




// ------------ 아래 방법도 있다.  
...

HttpServletRequest request

){

String b_no = request.getParameter("b_no");
    if( b_no == null){

    }
    else{

    }

...

```
> `@RequestParam(value = "b_no") int b_no ` 추가.  
> 이 코드 때문에 새글쓰기가 에러가 난다.  
> b_no 가 무조건 있어야 진행이 된다.  

> 해결방법1.    
> `HttpServletRequest request` 하고,  
> `String b_no = request.getParameter("b_no");` 로 꺼내주고, 조건문으로 null 값 혹은 PK값 들어왔을때를 조건 주면 된다.  

> 해결방법2.     
> `@RequestParam(value = "b_no", required = false, defaultValue = "0") int b_no `  로 해결.  
> `RequestParam` 은 필수요소인데, 만약 false 라면,   
> 디폴트값으로 0을 주는 코딩.  

#

----
### `10:30~`

`boardRegForm.jsp` 에서,    
새글쓰기, 댓글쓰기 조건에 따라 바뀌도록,  

```java
<% if( request.getParameter("b_no")==null) { %>

    <caption>새글쓰기</caption>

<% }else{ %>

    <caption>댓글쓰기</caption>

<% } %>    
```
> `매개변수`는 메소드 안에서만 사용하고 사라지는 지역변수이다.  
> `HttpServletRequest` 객체는 html 로 응답하고 사라지기 때문에 jsp 페이지 에서도 사용 가능하다.  

> ![JSP 스크립트릿](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210830%201051_JSP%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EB%A6%BF_.png)  

히든태그도 추가해야 한다.  

```html
<!-- ------------------------------------------------- -->
<!-- 만약 파명 b_no 의 파값이 null 이면 name="b_no" 를 가진 hidden 태그의 value 에 0 입력하기 -->
<!-- 만약 파명 b_no 의 파값이 null 아니면 name="b_no" 를 가진 hidden 태그의 value 에 파값을 입력하기 -->
<!-- ------------------------------------------------- -->
<% if( request.getParameter("b_no")==null) { %>

    <input type="hidden" name="b_no" value="0">

<% }else{ %>

    <input type="hidden" name="b_no" value="<%=request.getParameter("b_no")%>">

<% } %>    


<!-- #################################### -->

아래 두개는 같은 표현이다.  
<%=request.getParameter("b_no")%>
<%out.print(request.getParameter("b_no"));%>
```

#

`BoardController` 에서,     
`"/boardRegProc.do"` 부분, 수정할것이 없음.      

#

오라클에서 `<167> 번` 댓글쓰기 쿼리문 다시보기.  

----
### `11:30~`

댓글 쓸때는,  
부모 PK 활용하여  
부모글의 그룹번호,    
출력순서번호,    
들여쓰기번호,    
를 구해야 한다.    

추가적으로 

다른 글들의 출력 순서번호도 업데이트 해주어야 한다.  

![댓글_출력_들여쓰기 설명](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210830%201138_%EB%8C%93%EA%B8%80%EC%B6%9C%EB%A0%A5%EB%93%A4%EC%97%AC%EC%93%B0%EA%B8%B0_.png)       

#

`BoardServiceImpl.java` 에서 추가 코딩,  

```java
public int insertBoard( BoardDTO boardDTO ){

    // ---------------------------------------
    // 만약 엄마글의 글 번호가 1 이상이면 댓글쓰기 이므로
    // 엄마 글 이후의 게시판 글에 대해 출력순서번호를 1 증가 시키기.
    // ---------------------------------------
    if( boardDTO.getB_no()>0 ){
        // ---------------------------------------
        // BoardDAOImpl 객체의 updatePrintNo 메소드를 호출하여 출력 순서 번호를 1증가시키고
        // 수행정에 적용 개수를 리턴받는다.
        // 게시판 글이 입력되는 부분 이후 글들은 출력 순서번호를 1씩 증가하여야 한다.   
        // 게시판 테이블 분석 요망. 오늘 집에 가서 게시판 테이블 분석해야함.  
        // ---------------------------------------
        int updatePrintNoCnt = this.boardDAO.updatePrintNo(boardDTO); 


    }
```
> 댓글인지 새글인지 힌트는 b_no 를 활용해야 한다.    
> 부모글의 데이터가 저장된 변수를 활용해야 한다.  

#

`BoardDAO.java` 에서,    

```java 
// ******************************************************
// [게시판 글 출력번호 1증가하고 수정 행의 개수] 리턴하는 메소드 선언
// ******************************************************
int updatePrintNo(BoardDTO boardDTO);
```

#

`BoardDAOImpl.java` 에서,   

```java 
// ******************************************************
// [게시판 글 출력번호 1증가하고 수정 행의 개수] 리턴하는 메소드 선언
// ******************************************************
public int updatePrintNo(BoardDTO boardDTO){

    System.out.println("BoardDAOImpl updatePrintNo 메서드 호출 ");

    //-------------------------------------------------------
    // [SqlSessionTemplate 객체]의 update(~,~) 를 호출하여 
    // [게시판 글 출력번호 1증가하고 수정 행의 개수] 얻기
    //-------------------------------------------------------
    int updatePrintNoCnt = sqlSession.update(
        
        "com.naver.erp.BoardDAO.updatePrintNo"  // 실행할 SQL 구문의 위치 지정
        ,boardDTO							    // 실행할 SQL 구문에서 사용할 데이터 지정

    );
    //-------------------------------------------------------
    // [수정 행의 개수] 리턴하기
    //-------------------------------------------------------
    return updatePrintNoCnt;

}

```
 
#

`mapper_board.xml` 에서,    
쿼리 작성

```xml
<!-- ********************************************************************* -->
<!-- 게시판 글 출력 번호 1증가하는 update 문을 내포한 update 태그 선언 -->
<!-- ********************************************************************* -->
<update id="updatePrintNo" parameterType="com.naver.erp.BoardDTO">

    update board set print_no = print_no + 1
    where 
        group_no = (select group_no from board where b_no=#{b_no}) 
        and
        print_no > (select print_no from board where b_no=#{b_no}) 

</update>
```

게시글 입력부분(insertBoard) 쿼리 수정해야 함.  
> xml 은 마이바티스가 관리하는 쿼리.     
> xml 안에서 조건문 쓰기.      

```xml
  <!-- ********************************************************************
  만약에 자바의 BoardDTO 객체의 속성변수 b_no 가 0이면, 즉, 새글쓰기 모드면
  그룹번호를 PK 값으로, 출력순서 번호와 들여쓰기 레벨은 0 으로 입력하기
  ********************************************************************* -->
  <if test="b_no==0">
  ,(select nvl(max(b_no),0)+1 from board)
  ,0
  ,0
  </if>

  <!-- ********************************************************************
  만약에 자바의 BoardDTO 객체의 속성변수 b_no 가 0보다 크면, 즉, 댓글쓰기 모드면
  그룹번호를 엄마 PK 번호로, 출력순서 번호와 들여쓰기 레벨은
  엄마꺼보다 1 더 큰 값으로 입력하기
  ********************************************************************* -->
  <if test="b_no>0">
  , (select group_no from board where b_no=#{b_no}) 
  , (select print_no + 1 from board where b_no=#{b_no}) 
  , (select print_level + 1 from board where b_no=#{b_no}) 
  </if>
```

#


















----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`

9월 3일,  

이번주 금요일 휴강.    

#

게시판 소스 완성하면,    

교재로 돌아가서 소스 분석들어감.    







