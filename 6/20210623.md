# 2021년 6월 23일 [30일차]

## # 오전수업
----
### `09:30~`

<복습>  
- `Subquery`  
  1. 비상관쿼리 (Noncorrelated Subquery)
  2. 상관쿼리 (Correlated Subquery)


### <118> [직원번호], [직원명], [담당고객수]를 출력하면?

![](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210623%200956.jpg)  

```SQL  
select
	e.emp_no    "직원번호"
	,e.emp_name "직원명"
	,(select count(*) from customer c where c.emp_no = e.emp_no) "담당고객수"
from
	employee e;

조인도 아닌데 별칭을 쓴다는것은 서브쿼리인것을 유추할수 있어야 한다.    
```

### <119> 애래 처럼 [부서명], [부서직원수], [부서담당고객수]를 출력하면?

```SQL  
select
	d.dep_name "부서명"
	,(select count(*) from employee e where e.dep_no = d.dep_no)||'명'  "부서직원수"
	,(select count(*) from employee e, customer c where e.dep_no = d.dep_no and e.emp_no = c.emp_no)||'명' "부서담당고객수"
from
	dept d;

from 절에 테이블이 2개 나온것이면, 조인.
그 뒤 where 은 조인 조건절.    
e.dep_no = d.dep_no 행을 골라내기 위한 조건.
e.emp_no = c.emp_no 조인 조건.
```

### <120> [직원번호], [직원명], [직급], [주민번호], [직급서열순위]를 출력하면? 단, 직급이 같으면 나이 많은 직원이 [직급서열순위] 위이다. 그리고 [직급서열순위]를 오름차순 유지.

```SQL
내가한것.   
select
	e1.emp_no
	,e1.emp_name
	,e1.jikup
	,e1.jumin_num
	,(select count(*)+1 from employee e2 where decode( e2.jikup
		,'사장', 1
		,'부장', 2
		,'과장', 3
		,'대리', 4
		,'주임', 5
		,6
	)|| decode (substr(e2.jumin_num,7,1), '1', '19', '2', '19', '20' )
    || substr(e2.jumin_num,1,6)
	< decode( e1.jikup
		,'사장', 1
		,'부장', 2
		,'과장', 3
		,'대리', 4
		,'주임', 5
		,6
	)|| decode (substr(e1.jumin_num,7,1), '1', '19', '2', '19', '20' )
    || substr(e1.jumin_num,1,6) )
	 "직급서열순위"
from
	employee e1
order by
	5 asc;
```

```SQL
decode 안쓰고 case 문으로..  
select
	e1.emp_no      "직원번호"
	,e1.emp_name   "직원명"
	,e1.jikup      "직급"
	,e1.jumin_num  "주민번호"
	, (select count(*)+1 from employee e2 where case (e2.jikup
		when '사장' then 1
		when '부장' then 2
		when '과장' then 3
		when '대리' then 4
		when '주임' then 5 else 6
	end
	)|| case (substr(e2.jumin_num,7,1)
	 	when '1' then '19'
		when '2' then '19'
		else '20' end)
		|| substr(e2.jumin_num,1,6)
< case (e1.jikup
	when '사장' then 1
	when '부장' then 2
	when '과장' then 3
	when '대리' then 4
	when '주임' then 5 else 6
end
)|| case (substr(e1.jumin_num,7,1)
	when '1' then '19'
	when '2' then '19'
	else '20' end)
	|| substr(e1.jumin_num,1,6)
) "직급서열순위"
from
	employee e1
order by 5;
```
<case절 완성해보기..>

----
### `10:30~`

```SQL
강사님 정답.  
select
	e1.emp_no      "직원번호"
	,e1.emp_name   "직원명"
	,e1.jikup      "직급"
	,e1.jumin_num  "주민번호"
	,(
		select count(*)+1 from employee e2
		where
		decode( e2.jikup
			,'사장', 1
			,'부장', 2
			,'과장', 3
			,'대리', 4
			,'주임', 5
			,6)
		<
		decode( e1.jikup
			,'사장', 1
			,'부장', 2
			,'과장', 3
			,'대리', 4
			,'주임', 5
			,6)
		or
		(
			e2.jikup = e1.jikup
			and
			to_number(
        decode (substr(e2.jumin_num,7,1), '1', '19', '2', '19', '20' )
		    ||substr(e2.jumin_num,1,6)
      )  
      <
			to_number(
        decode (substr(e1.jumin_num,7,1), '1', '19', '2', '19', '20' )
		    ||substr(e1.jumin_num,1,6)
      )  
		)
	)         "직급서열순위"
from
	employee e1
order by
	5;

문자 자리수가 일치하면 그대로 비교하여도 되지만 정확하고 확실한것은 to_number 을 써주는것이 맞다.
```

### <121> 고객번호, 곡개명, 고객전화번호, 담당직원명, 담당직원직급, 부서번호 를 출력하면? <조건>담당직원이 없는 고객도 포함 단, 조인을 사용하지 말고 서브쿼리를 사용하십시오.

```SQL  
---------------------------------------------
서브쿼리 답
---------------------------------------------
select
  c.cus_no     "고객번호"
  ,c.cus_name  "고객명"
  ,c.tel_num   "고객전화번호"
  ,(select e.emp_name from employee e where e.emp_no = c.emp_no ) "담당직원명"
  ,(select e.jikup from employee e where e.emp_no = c.emp_no ) "담당직원직급"
  ,(select e.dep_no from employee e where e.emp_no = c.emp_no )"부서번호"
from customer c;

---------------------------------------------
조인 답(오라클조인)
---------------------------------------------
select
  c.cus_no     "고객번호"
  ,c.cus_name  "고객명"
  ,c.tel_num   "고객전화번호"
  ,e.emp_name  "담당직원명"
  ,e.jikup     "담당직원직급"
  ,e.dep_no    "부서번호"
from
  customer c, employee e
where
  c.emp_no = e.emp_no(+)
order by
1 asc;
---------------------------------------------
조인 답(ANSI 조인)
---------------------------------------------
select
  c.cus_no     "고객번호"
  ,c.cus_name  "고객명"
  ,c.tel_num   "고객전화번호"
  ,e.emp_name  "담당직원명"
  ,e.jikup     "담당직원직급"
  ,e.dep_no    "부서번호"
from
  customer c left outer join employee e
on
  c.emp_no = e.emp_no
order by
1 asc;
```

----
### `11:30~`

### <122>






----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`
