# 2021년 6월 30일 [35일차]

## # 오전수업
----
### `09:30~`

<오늘 할 것>  

게시판 새글쓰기    
댓글쓰기    

쿼리 입력, 수정    

오후에 게시판 검색   

JSP와 연관이 많다.  

[JSP책 추천 : 내용이 자세하다](https://book.naver.com/bookdb/book_detail.nhn?bid=9789206)  

#   

### <165> 게시판에 입력되는 데이터를 저장하려면 테이블 구조는 어떻게 설계해야 될까?

`group_no`, `print_no`, `print_level` 이 세가지를 잘 파악해야 한다.  

```SQL  
b_no        -> 게시판 글 고유번호

subject     -> 글 제목       => 직접입력
writer      -> 글쓴이 이름   => 직접입력
content     -> 글 내용       => 직접입력
pwd         -> 암호          => 직접입력
email       -> 이메일        => 직접입력

reg_date    -> 등록일  
readcount   -> 조회수  => update

group_no    -> 게시판 글의 소속 그룹번호. 정렬 시 사용.
print_no    -> 같은 그룹번호 내에서 화면 출력 순서 번호. 정렬 시 사용.

print_level -> 같은 그룹번호 내에서 댓글 들여쓰기 레벨 단계 번호. 부모 자식 관계를 알 수 있다.
--------------------------------------------------------
그룹번호가 같다면 메인글에 속한것이다.  
그룹번호를 같게 만드는 이유는? => 정렬 때문이다.
```

#### SQL문 작성

```SQL  
create table board (
b_no        number(9)                        --> 게시판 글 고유번호

,subject     varchar2(50)     not null            --> 글 제목
,writer      varchar2(30)     not null            --> 글쓴이 이름
,content     varchar2(2000)   not null            --> 글 내용
,pwd         varchar2(12)     not null            --> 암호
,email       varchar2(30)                         --> 이메일

,reg_date    date            default sysdate     --> 등록일
,readcount   number(5)       default 0           --> 조회수

,group_no    number(9)       not null            --> 게시판 글의 소속 그룹번호. 정렬 시 사용.
,print_no    number(9)       not null            --> 같은 그룹번호 내에서 화면 출력 순서 번호. 정렬 시 사용.

,print_level number(9)       not null            --> 같은 그룹번호 내에서 댓글 들여쓰기 레벨 단계 번호. 부모 자식 관계를 알 수 있다.

,primary key(b_no)
)

select * from board;
```

```SQL  
----------------------------------
<새끼문제> 정렬에 관련된 컬럼은?
----------------------------------
  group_no, print_no
  ----------------------------------
  정렬시
  먼저 그룹번호를 내림차순으로 정렬하고, 같은 그룹번호 내에서 화면 출력 순서를 오름차순으로 정렬할 것이다.
----------------------------------
<새끼문제> 부모자식 관계를 표현하는데 사용되는 데이터가 있는 컬럼은?
----------------------------------
  print_level
  ----------------------------------
  자식은 부모보다 1단계 오른쪽으로 밀려들어가게 만든다.

```

----
### `10:30~`

#### 글 생성후, [그룹번호], [출력순서번호], [들여쓰기번호] 생성 설명 이미지.  

![이미지첨부](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210630%201041.png)    

![이미지첨부](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210630%201045.png)    

![이미지첨부](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210630%201047.png)    

![이미지첨부](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210630%201056.png)     

댓글은 바로위 부모에게서 그룹번호와 출력순서번호를 따온다.  

대댓글이 올라오면, 바로위 부모글 조회수 1이 먼저 올라간다.  
(부모글을 보아야 댓글을 달 수 있으니까)  

대댓글이 올라오면 그 아래 출력순서번호 글들의 출력순서번호가 업데이트 된다.  

`group_no`, `print_no`, `print_level` 중,  

[출력순서번호] `print_no` 에 신경을 써줘야 한다.  
글이 추가 될수록 계속 바뀌기 때문.  



#### 댓글이 아니라 새글이 올라오는 경우.

![이미지첨부](https://github.com/SungWoo0315/study-repository/blob/main/image-save/20210630%201102.png)


----
### `11:30~`

### <166> 게시판이 오픈 된 후 처음으로 누군가 아래처럼 글을 올렸다. insert 구문을 쓰면?
```
	글제목   => 11월 모두 취업합시다.
	글내용   => 어쩌구 저쩌구
	글쓴이   => 희원
	이메일   => hwon@naver.com
	비밀번호 => 1234
```

default 값은 안주어도 된다.  

```SQL  
/*
create sequence boar_sq
  start with 0
  increment by 1
  minvalue 0
  maxvalue 999999999;
*/

insert into board(
	b_no
	, subject
	, writer
	, content
	, pwd
	, email
--	, reg_date  -- default 값이 있으므로 등록하지 않아도 된다.
--	, readcount -- default 값이 있으므로 등록하지 않아도 된다.
	, group_no
	, print_no
	, print_level
)

values(
--board_sq.nextval
	(select nvl(max(b_no),0)+1 from board) -- PK넘버.
	, '11월 모두 취업합시다'
	, '희원'
	, '어쩌구 저쩌구'
	, '1234'
	, 'hwon@naver.com'
	--, sysdate -- default 값이 있으므로 등록하지 않아도 된다.
	--, 0       -- default 값이 있으므로 등록하지 않아도 된다.
	, (select nvl(max(b_no),0)+1 from board)
	, 0
	, 0
);
```


### <167> 누군가 게시판 번호 1번 에 아래처럼 댓글을 올렸다. 이때 댓글 올리는 과정 중에 발생되는 SQL 모두 써라.
```
	글제목   => 맞습니다. 열공합시다.
	글내용   => 어쩌구 저쩌구
	글쓴이   => 영민
	이메일   => min@naver.com
	비밀번호 => 2345
```

힌트.    
부모글의 조회수를 1 업데이트하기    
밑으로 내리는 글의 출력 순서번호를 1 업데이트하기  
댓글 입력하기  

```SQL  
-----------------------------------------------------
-- 부모글의 조회수를 1 업데이트하기
update board set readcount = readcount + 1 where b_no=1;
-----------------------------------------------------
-- 밑으로 내리는 글의 출력 순서번호를 1 업데이트하기
update board set print_no = print_no + 1
where group_no = (select group_no from board where b_no = 1) -- b_no가 1번인 글의 그룹번호
  print_no > (select print_no from board where b_no = 1) -- b_no 가 1번인 글의 출력순서번호

-- 업데이트 대상이 없으면 에러가 나는것이 아니라 작동을 하지 않는다.   
-----------------------------------------------------
-- 댓글 입력하기
insert into board (
  b_no
  , subject
  , writer
  , content
  , pwd
  , email
  , group_no
  , print_no
  , print_level
)
values (
  (select nvl(max(b_no),0)+1 from board)
  , '맞습니다. 열공합시다.'
  , '영민'
  , '어쩌구 저쩌구'
  , '2345'
  , 'min@naver.com'
  , (select group_no from board where b_no=1) -- b_no가 1번인글의 그룹번호
  , (select print_no + 1 from board where b_no=1) -- b_no가 1번인글의 출력순서번호에 1더한거
  , (select print_level + 1 from board where b_no=1) -- b_no가 1번인글의 들여쓰기번호에 1더한거
)
```

















###

```SQL  

```

###

```SQL  

```









----
### `12:30~`








----
### `13:20~`

  - 점심시간.

---
---

## # 오후수업

---
### `14:30~`










---
### `15:30~`









----
### `16:30~`








----
### `17:30~`








----
### `18:30~`
